#!/bin/zsh
set -Ceu
ffmpeg=$HOME/bin/ffmpeg_
IFS=$'\n'
function encoding () {
	for file in `find . -maxdepth 1 -name '*.ts'`; do
		if [ ! -e "${file%ts}webm" ]; then
			$ffmpeg -n -i $file -c:v libvpx-vp9 -c:a libopus \
			-vpre vp9-testing \
			-vf bwdif=1:-1:0 -crf 32 "${file%ts}webm"
		else
			sleep 2s
		fi
	done
}

while true
do
	encoding
done

